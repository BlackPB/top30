<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì£¼ì‹ Top30 ë°ì´í„° ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        /* --- ê¸°ë³¸ ë¦¬ì…‹ ë° í°íŠ¸ --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            /* ì„¸ë ¨ëœ ë‹¤í¬ ëª¨ë“œ ìŠ¤íƒ€ì¼ ë°°ê²½ */
            font-family: 'Pretendard', 'Malgun Gothic', 'ë§‘ì€ ê³ ë”•', sans-serif;
            line-height: 1.6;
            background: #1a1a2e; /* ì§™ì€ ë„¤ì´ë¹„/í¼í”Œ í†¤ */
            color: #e0e0e0; /* ê¸°ë³¸ í…ìŠ¤íŠ¸ ìƒ‰ìƒ */
            min-height: 100vh;
            padding: 20px;
        }
        
        /* í°íŠ¸ ë¡œë“œ (Pretendardê°€ ì—†ëŠ” ê²½ìš°ë¥¼ ëŒ€ë¹„) */
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap');

        /* --- ì»¨í…Œì´ë„ˆ ë° í—¤ë” --- */
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            text-align: center;
            color: #f0f8ff; /* ë°ì€ í†¤ í—¤ë” */
            margin-bottom: 40px;
            padding: 30px 20px;
            background: rgba(0, 0, 0, 0.2); /* ì•½ê°„ì˜ ë°°ê²½ ë¶„ë¦¬ */
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .header h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            /* ì£¼ì‹ ìƒìŠ¹ ëŠë‚Œì˜ ê·¸ë¼ë°ì´ì…˜ í…ìŠ¤íŠ¸ */
            background: linear-gradient(45deg, #1abc9c, #2ecc71); 
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(46, 204, 161, 0.5);
        }
        
        .header p {
            font-size: 1.1rem;
            opacity: 0.8;
            color: #b0c4de;
        }
        
        .card {
            background: #2c2c54; /* ë©”ì¸ ì¹´ë“œ ë°°ê²½ (ì–´ë‘ìš´ ë³´ë¼ìƒ‰) */
            border-radius: 15px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.5); /* ë” ê°•í•œ ê·¸ë¦¼ì */
            overflow: hidden;
            position: relative;
        }
        
        /* --- ì»¨íŠ¸ë¡¤ ë°” (ì…ë ¥ ë° ë²„íŠ¼) --- */
        .controls {
            padding: 20px;
            background: #3a3a60; /* ì»¨íŠ¸ë¡¤ ì˜ì—­ ë°°ê²½ */
            border-bottom: 1px solid #4a4a7a;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .input-group {
            display: flex;
            gap: 15px;
            align-items: center;
            flex: 2; /* URL ì…ë ¥ì— ë” ë§ì€ ê³µê°„ í• ë‹¹ */
            min-width: 400px;
        }
        
        #urlInput {
            flex: 1;
            min-width: 300px;
            padding: 12px 18px;
            border: 1px solid #5b5b85;
            border-radius: 8px;
            font-size: 16px;
            background: #1a1a2e; /* ì…ë ¥ì°½ ë‚´ë¶€ë¥¼ ë” ì–´ë‘¡ê²Œ */
            color: #f0f0f0;
            transition: all 0.3s ease;
        }
        
        #urlInput:focus {
            outline: none;
            border-color: #2ecc71; /* ì´ˆì  ì‹œ ë…¹ìƒ‰ ê°•ì¡° */
            box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.3);
        }
        
        .date-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #3a3a60;
            padding: 8px;
            border-radius: 8px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
        }

        .current-date {
            font-weight: 700;
            color: #f0f0f0;
            min-width: 110px;
            text-align: center;
            font-size: 15px;
            cursor: pointer;
            padding: 6px 12px;
            border-radius: 6px;
            transition: background-color 0.3s ease, color 0.3s ease;
            background-color: #5b5b85;
        }
        
        .current-date:hover {
            background-color: #7f7fbf;
        }
        
        .btn {
            padding: 10px 20px;
            /* ë©”ì¸ ë²„íŠ¼: ì‹œì›í•œ íŒŒë€ìƒ‰/ë³´ë¼ìƒ‰ */
            background: linear-gradient(135deg, #3498db, #8e44ad); 
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.3);
        }
        
        .btn:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 5px 12px rgba(52, 152, 219, 0.5);
        }
        
        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* íŠ¹ìˆ˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-fetch {
            background: linear-gradient(135deg, #2ecc71, #27ae60); /* ë…¹ìƒ‰ */
        }
        .btn-fetch:hover:not(:disabled) {
            box-shadow: 0 5px 12px rgba(46, 204, 113, 0.5);
        }
        
        .btn-copy {
            background: linear-gradient(135deg, #f39c12, #e67e22); /* ì£¼í™©ìƒ‰ */
        }
        .btn-copy:hover:not(:disabled) {
            box-shadow: 0 5px 12px rgba(243, 156, 18, 0.5);
        }
        
        .btn-nav {
            background: #5b5b85;
            padding: 6px 10px;
            font-size: 18px;
            font-weight: 800;
        }
        .btn-nav:hover:not(:disabled) {
            background: #7f7fbf;
        }
        
        .btn-settings {
            background: #9b59b6; /* ë³´ë¼ìƒ‰ */
            padding: 10px 15px;
            font-size: 14px;
        }
        .btn-settings:hover:not(:disabled) {
            box-shadow: 0 5px 12px rgba(155, 89, 182, 0.5);
        }
        
        .btn-upload {
            background: linear-gradient(135deg, #3498db, #2980b9);
            font-size: 14px;
        }
        
        .btn-export {
            background: linear-gradient(135deg, #1abc9c, #16a085); /* ì²­ë¡ìƒ‰ */
            font-size: 14px;
        }
        .btn-export:hover:not(:disabled) {
            box-shadow: 0 5px 12px rgba(26, 188, 156, 0.5);
        }
        
        .btn-import {
            background: linear-gradient(135deg, #e74c3c, #c0392b); /* ë¶‰ì€ìƒ‰ */
            font-size: 14px;
        }
        .btn-import:hover:not(:disabled) {
            box-shadow: 0 5px 12px rgba(231, 76, 60, 0.5);
        }

        /* --- ìº˜ë¦°ë” íŒì—… --- */
        .calendar-popup, .settings-calendar-popup {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: #2c2c54; /* ì–´ë‘ìš´ ë°°ê²½ */
            border: 1px solid #4a4a7a;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.6);
            padding: 15px;
            z-index: 1000;
            min-width: 280px;
            margin-top: 10px;
            color: #e0e0e0;
        }
        .settings-calendar-popup {
            left: 0;
            transform: none;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .calendar-nav {
            background: none;
            border: 1px solid #5b5b85;
            color: #b0c4de;
            font-size: 16px;
            cursor: pointer;
            padding: 5px 10px;
            border-radius: 4px;
            transition: background-color 0.2s ease, color 0.2s ease;
        }
        
        .calendar-nav:hover {
            background: #4a4a7a;
            color: white;
        }
        
        .calendar-title {
            font-weight: 700;
            font-size: 16px;
            color: #f0f0f0;
        }
        
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 3px;
        }
        
        .calendar-weekday {
            text-align: center;
            font-size: 12px;
            color: #95a5a6;
            padding: 5px;
            font-weight: 600;
        }
        
        .calendar-day {
            text-align: center;
            padding: 8px 5px;
            font-size: 13px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s ease;
            background-color: #3a3a60;
        }
        
        .calendar-day:hover {
            background: #4a4a7a;
        }
        
        .calendar-day.saturday {
            color: #3498db !important; /* íŒŒë‘ */
        }
        
        .calendar-day.sunday, .calendar-day.holiday {
            color: #e74c3c !important; /* ë¹¨ê°• */
            background: #4a4a7a;
        }
        
        .calendar-day.today {
            background: #f39c12; /* ì˜¤ëŠ˜(Today) ê°•ì¡° */
            color: #1a1a2e !important;
            font-weight: bold;
        }
        
        .calendar-day.selected {
            background: #2ecc71; /* ì„ íƒë¨ */
            color: white !important;
            font-weight: bold;
        }
        
        .calendar-day.disabled {
            color: #666 !important;
            cursor: not-allowed;
            background: #3a3a60;
        }
        
        .calendar-day.disabled:hover {
            background: #3a3a60;
        }
        
        /* --- ìƒíƒœ í‘œì‹œ (Status) --- */
        .status {
            padding: 20px 30px;
            text-align: center;
        }
        
        .loading {
            color: #2ecc71;
            font-size: 18px;
            font-weight: 700;
        }
        
        .error {
            color: #e74c3c;
            background: #3c2c2c; /* ì–´ë‘ìš´ ì˜¤ë¥˜ ë°°ê²½ */
            padding: 15px;
            border-radius: 8px;
            border-left: 5px solid #e74c3c;
            font-weight: 600;
        }
        
        .success {
            color: #2ecc71;
            background: #2c4c34; /* ì–´ë‘ìš´ ì„±ê³µ ë°°ê²½ */
            padding: 15px;
            border-radius: 8px;
            border-left: 5px solid #2ecc71;
            font-weight: 600;
        }
        
        /* --- í…Œì´ë¸” --- */
        .table-container {
            overflow-x: auto;
            padding: 20px 30px;
            background: #2c2c54;
            margin: 0 20px 20px 20px;
            border-radius: 0 0 15px 15px;
            min-height: 600px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 15px;
            min-width: 800px;
            table-layout: fixed;
        }
        
        th {
            /* í…Œì´ë¸” í—¤ë”: ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ë²„íŠ¼ê³¼ ìœ ì‚¬í•œ ê°•ì¡° ìƒ‰ìƒ */
            background: linear-gradient(135deg, #8e44ad, #9b59b6); 
            color: white;
            padding: 18px 15px;
            text-align: left;
            font-weight: 700;
            position: sticky;
            top: 0;
            font-size: 15px;
            border-bottom: 2px solid #a0a0c0;
        }
        
        td {
            padding: 16px 15px;
            border-bottom: 1px solid #4a4a7a;
            font-size: 15px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #e0e0e0;
        }
        
        tr:nth-child(odd) {
            background-color: #2c2c54; /* í™€ìˆ˜ í–‰ì€ ë©”ì¸ ì¹´ë“œ ë°°ê²½ê³¼ ë™ì¼ */
        }
        tr:nth-child(even) {
            background-color: #35355a; /* ì§ìˆ˜ í–‰ì€ ì•½ê°„ ë°ê²Œ */
        }
        
        tr:hover {
            background-color: #4a4a7a !important; /* í˜¸ë²„ ì‹œ ê°•ì¡° */
            transition: all 0.2s ease;
        }
        
        /* ì»¬ëŸ¼ ë„ˆë¹„ (ìœ ì§€) */
        .theme-main-col { width: 140px; }
        .theme-sub-col { width: 180px; }
        .date-col { width: 110px; }
        .stock-name-col { width: 160px; }
        .rise-rate-col { width: 100px; }
        .reason-col { } /* ë‚˜ë¨¸ì§€ */
        
        .date {
            color: #95a5a6;
            font-size: 14px;
        }
        
        .theme-main {
            background: #27ae6040; /* ë°ì€ ë…¹ìƒ‰ + íˆ¬ëª…ë„ */
            color: #2ecc71;
            padding: 5px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            display: inline-block;
        }
        
        .theme-sub {
            background: #3498db40; /* ë°ì€ íŒŒë‘ + íˆ¬ëª…ë„ */
            color: #3498db;
            padding: 5px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            display: inline-block;
        }
        
        .stock-name {
            font-weight: 600;
            color: #f0f0f0;
            font-size: 15px;
        }
        
        .rise-rate {
            font-weight: bold;
            text-align: right;
            font-size: 15px;
        }
        /* ìƒìŠ¹/í•˜ë½ ìƒ‰ìƒ ëª…í™•íˆ */
        .rise-rate.up { color: #e74c3c; } /* ìƒìŠ¹ (ë¹¨ê°„ìƒ‰) */
        .rise-rate.down { color: #3498db; } /* í•˜ë½ (íŒŒë€ìƒ‰) */
        .rise-rate.zero { color: #e0e0e0; } /* ë³´í•© */
        
        .reason {
            font-size: 14px;
            color: #a0a0c0;
            line-height: 1.5;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            justify-content: flex-end;
            flex: 1;
        }
        
        /* --- ì„¤ì • íŒ¨ë„ --- */
        .settings-panel {
            background: #3a3a60; /* ì»¨íŠ¸ë¡¤ ë°”ì™€ ìœ ì‚¬í•œ í†¤ */
            border: 1px solid #4a4a7a;
            border-radius: 10px;
            padding: 25px;
            margin: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.5);
            position: relative;
        }
        
        .settings-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: #2ecc71; /* ì„¤ì • íƒ€ì´í‹€ ë…¹ìƒ‰ ê°•ì¡° */
            border-bottom: 2px solid #4a4a7a;
            padding-bottom: 10px;
        }
        
        .settings-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            align-items: end;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-group label {
            font-weight: 600;
            color: #b0c4de;
            font-size: 14px;
        }
        
        .form-group input[type="text"], 
        .form-group input[type="number"] {
            padding: 10px 12px;
            border: 1px solid #5b5b85;
            border-radius: 6px;
            font-size: 14px;
            background: #1a1a2e;
            color: #f0f0f0;
            transition: all 0.3s ease;
        }
        
        .form-group input:focus {
            outline: none;
            border-color: #2ecc71;
            box-shadow: 0 0 0 3px rgba(46, 204, 113, 0.3);
        }
        
        .settings-date-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }
        
        .settings-date {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid #5b5b85;
            border-radius: 6px;
            font-size: 14px;
            text-align: center;
            cursor: pointer;
            background: #1a1a2e;
            color: #f0f0f0;
            transition: all 0.3s ease;
        }
        
        .settings-date:hover {
            border-color: #2ecc71;
        }
        
        .upload-info {
            background: #2c4c34;
            padding: 12px;
            border-radius: 8px;
            border-left: 5px solid #2ecc71;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .backup-section {
            background: #3a3a60;
            padding: 20px;
            border-radius: 10px;
            border-left: 5px solid #3498db;
            margin-top: 30px;
        }
        
        .backup-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        
        /* --- ë°˜ì‘í˜• ë””ìì¸ --- */
        @media (max-width: 1024px) {
            .header h1 { font-size: 2.4rem; }
            .controls { flex-direction: column; align-items: stretch; }
            .input-group { flex-direction: column; min-width: 100%; }
            #urlInput { min-width: 100%; }
            .button-group { justify-content: center; }
            
            .settings-form { grid-template-columns: 1fr; }
            .settings-panel { margin: 15px; }
        }

        @media (max-width: 768px) {
            body { padding: 15px; }
            .container { padding: 0; }
            .card { border-radius: 0; box-shadow: none; }
            .table-container { margin: 0; border-radius: 0; }
            
            .header { margin-bottom: 20px; padding: 20px 10px; }
            .header h1 { font-size: 2rem; }

            .controls { padding: 15px 10px; gap: 10px; }
            .btn { padding: 10px 15px; font-size: 14px; }
            
            th, td { padding: 12px 8px; font-size: 13px; }
            
            .theme-main-col { width: 110px; }
            .theme-sub-col { width: 130px; }
            .stock-name-col { width: 120px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“ˆ ì£¼ì‹ Top30 ë°ì´í„° ëŒ€ì‹œë³´ë“œ</h1>
            <p>ì‹¤ì‹œê°„/ê³¼ê±° ì£¼ì‹ ì •ë³´ë¥¼ ì¡°íšŒí•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ì„¸ìš”.</p>
        </div>
        
        <div class="card">
            <div class="controls">
                <div class="input-group">
                    <input type="text" id="urlInput" 
                           placeholder="ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¬ URLì„ ì…ë ¥í•˜ì„¸ìš”">
                    <div class="date-controls">
                        <button class="btn btn-nav" id="prevBtn" onclick="navigateDate(-1)">â—€</button>
                        <div class="current-date" id="currentDate" onclick="toggleCalendar()">-</div>
                        <button class="btn btn-nav" id="nextBtn" onclick="navigateDate(1)">â–¶</button>
                        <div id="calendar" class="calendar-popup" style="display: none;"></div>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn btn-fetch" id="fetchBtn" onclick="fetchData()">
                        ğŸ”„ ë°ì´í„° ì¡°íšŒ
                    </button>
                    <button class="btn btn-copy" onclick="copyToExcel()">
                        ğŸ“‹ ì—‘ì…€ ë³µì‚¬
                    </button>
                    <button class="btn btn-settings" onclick="toggleSettings()">
                        âš™ï¸ ì„¤ì •
                    </button>
                    <button class="btn btn-settings" onclick="showCacheInfo()">
                        ğŸ” ìºì‹œì •ë³´
                    </button>
                </div>
            </div>

            <div id="settingsPanel" class="settings-panel" style="display: none;">
                <div class="settings-title">ğŸŒ ê¸°ë³¸ URL ë° ê¸°ì¤€ ì„¤ì •</div>
                <div class="settings-form">
                    <div class="form-group">
                        <label for="baseUrlInput">ê¸°ë³¸ URL</label>
                        <input type="text" id="baseUrlInput" placeholder="https://stockinfo7.com/stock/top30/text/">
                    </div>
                    <div class="form-group">
                        <label for="baseIdInput">ê¸°ì¤€ ì‹œì‘ ID</label>
                        <input type="number" id="baseIdInput" placeholder="1537">
                    </div>
                    <div class="form-group">
                        <label for="baseDateDisplay">ê¸°ì¤€ ë‚ ì§œ (ID ì‚°ì¶œ ì‹œì‘)</label>
                        <div class="settings-date-controls">
                            <div class="settings-date" id="baseDateDisplay" onclick="toggleSettingsCalendar(this)">ë‚ ì§œ ì„ íƒ</div>
                            <div id="settingsCalendar" class="settings-calendar-popup" style="display: none;"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-settings" onclick="saveBaseSettings()">
                            ğŸ’¾ ì„¤ì • ì €ì¥ & ì ìš©
                        </button>
                    </div>
                </div>

                <div class="settings-title" style="margin-top: 40px;">ğŸ“Š í…Œë§ˆ ë°ì´í„° ê´€ë¦¬</div>
                <div class="settings-form">
                    <div class="form-group" style="grid-column: 1 / -1;">
                        <label for="excelFileUpload">í…Œë§ˆ ë§¤í•‘ ì—‘ì…€ íŒŒì¼ ì—…ë¡œë“œ (.xlsx, .xls, .csv)</label>
                        <input type="file" id="excelFileUpload" accept=".xlsx,.xls,.csv" class="file-input">
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button class="btn btn-upload" onclick="uploadExcelFile()">
                                ğŸ“¤ í…Œë§ˆ íŒŒì¼ ì—…ë¡œë“œ
                            </button>
                            <button class="btn btn-settings" onclick="clearThemeData()">
                                ğŸ—‘ï¸ í…Œë§ˆ ë°ì´í„° ì´ˆê¸°í™”
                            </button>
                        </div>
                        <div id="uploadInfo" class="upload-info" style="display: none;"></div>
                    </div>
                </div>

                <div class="backup-section">
                    <div class="settings-title">ğŸ’¾ ë°ì´í„° ë°±ì—… ë° ë³µì›</div>
                    <p style="margin-bottom: 15px; color: #b0c4de; font-size: 13px;">
                        ëª¨ë“  ì„¤ì •, í…Œë§ˆ ë°ì´í„°, ì¡°íšŒ ê¸°ë¡(ìºì‹œ)ì„ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•˜ì„¸ìš”.
                    </p>
                    <div class="backup-buttons">
                        <button class="btn btn-export" onclick="exportAllData()">
                            ğŸ’¾ ì „ì²´ ë°ì´í„° ë‚´ë³´ë‚´ê¸° (JSON)
                        </button>
                        <button class="btn btn-import" onclick="document.getElementById('importFile').click()">
                            ğŸ“¥ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (JSON)
                        </button>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importAllData(this.files[0])">
                        <button class="btn btn-settings" onclick="clearAllData()">
                            ğŸ—‘ï¸ ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™”
                        </button>
                    </div>
                    <div style="margin-top: 15px; font-size: 12px; color: #95a5a6;">
                        <strong>ë°±ì—… ë‚´ìš©:</strong> ê¸°ë³¸ ì„¤ì •, í…Œë§ˆ ë°ì´í„°, ë°ì´í„° ìºì‹œ, ë‚ ì§œ ë§¤í•‘
                    </div>
                </div>
            </div>
            
            <div id="status" class="status">
                <div id="loading" class="loading" style="display: none;">
                    â³ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...
                </div>
                <div id="error" class="error" style="display: none;"></div>
                <div id="success" class="success" style="display: none;"></div>
            </div>
            
            <div class="table-container">
                <div id="tableContainer">
                    </div>
            </div>
        </div>
    </div>

    <script>
        // JavaScript ì½”ë“œëŠ” ë³€ê²½ ì—†ì´ ìœ ì§€ë©ë‹ˆë‹¤. (ìš”ì²­ì‚¬í•­ì— ë”°ë¼)
        // ê¸°ë³¸ ì„¤ì •ê°’
        let baseUrl = 'https://stockinfo7.com/stock/top30/text/';
        let baseId = 1537;
        let baseDate = new Date('2025-10-21');
        
        let currentId = baseId;
        let isFetching = false;
        let currentRealDate = '';
        let calendarVisible = false;
        let currentCalendarDate = new Date();
        let settingsCalendarVisible = false;

        // ğŸ”¥ ë°ì´í„° ìºì‹œ ì‹œìŠ¤í…œ - ì›¹ ê¸°ë°˜ìœ¼ë¡œ ë³€ê²½
        let dataCache = new Map(); // IDë¥¼ í‚¤ë¡œ ë°ì´í„° ì €ì¥
        let dateToIdCache = new Map(); // ë‚ ì§œ ë¬¸ìì—´ì„ í‚¤ë¡œ ID ì €ì¥

        // ê³µíœ´ì¼ ìºì‹œ (APIì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„° ì €ì¥)
        let holidaysCache = {};

        // ì—‘ì…€ í…Œë§ˆ ë°ì´í„° ìºì‹œ
        let themeDataCache = null;
        let currentThemeFileName = '';

        // ë‚ ì§œ-ID ë§¤í•‘ ìºì‹œ
        let dateIdCache = new Map();

        // ğŸ”¥ ì›¹ ê¸°ë°˜ ë°ì´í„° ì €ì¥ì†Œ (stock_data.json íŒŒì¼ ì‚¬ìš©)
        const WEB_DATA_FILE = 'stock_data.json';
        let webData = {
            metadata: {
                version: '1.0',
                lastUpdated: new Date().toISOString()
            },
            baseSettings: {
                baseUrl: baseUrl,
                baseId: baseId,
                baseDate: baseDate.toISOString()
            },
            themeData: {
                data: {},
                fileName: ''
            },
            cacheData: {
                dataCache: [],
                dateToIdCache: [],
                dateIdCache: []
            },
            currentState: {
                currentId: currentId,
                currentRealDate: currentRealDate
            }
        };

        // ğŸ”¥ í˜„ì¬ ì‹œê°„ì— ë”°ë¼ ìë™ìœ¼ë¡œ ë‚ ì§œ ê²°ì •í•˜ëŠ” í•¨ìˆ˜
        function getTargetDateByCurrentTime() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinutes = now.getMinutes();
            
            // ì˜¤í›„ 9ì‹œ(21ì‹œ) ê¸°ì¤€ìœ¼ë¡œ íŒë‹¨
            if (currentHour > 21 || (currentHour === 21 && currentMinutes >= 0)) {
                // ì˜¤í›„ 9ì‹œ ì´í›„: ì˜¤ëŠ˜ ë‚ ì§œ
                return new Date();
            } else {
                // ì˜¤í›„ 9ì‹œ ì´ì „: ì–´ì œ ë‚ ì§œ
                const yesterday = new Date();
                yesterday.setDate(yesterday.getDate() - 1);
                return yesterday;
            }
        }

        // ğŸ”¥ ê°€ì¥ ìµœê·¼ ê±°ë˜ì¼ì„ ì°¾ëŠ” í•¨ìˆ˜
        async function findLatestTradingDay(targetDate) {
            let checkDate = new Date(targetDate);
            let daysChecked = 0;
            const maxDaysToCheck = 10; // ìµœëŒ€ 10ì¼ê¹Œì§€ í™•ì¸ (ì£¼ë§, ê³µíœ´ì¼ ê³ ë ¤)
            
            while (daysChecked < maxDaysToCheck) {
                if (await isTradingDay(checkDate)) {
                    return checkDate;
                }
                // ì´ì „ ë‚ ì§œë¡œ ì´ë™
                checkDate.setDate(checkDate.getDate() - 1);
                daysChecked++;
            }
            
            // ê±°ë˜ì¼ì„ ì°¾ì§€ ëª»í•œ ê²½ìš° ê¸°ë³¸ê°’ ë°˜í™˜
            return targetDate;
        }

        // ğŸ”¥ ì´ˆê¸°í™” í•¨ìˆ˜ ìˆ˜ì • - í˜„ì¬ ì‹œê°„ì— ë”°ë¼ ìë™ìœ¼ë¡œ ë‚ ì§œ ì„¤ì •
        async function initialize() {
            loadBaseSettings();
            
            // ì›¹ ë°ì´í„° ë¡œë“œ
            await loadWebData();
            
            // í˜„ì¬ ì‹œê°„ì— ë”°ë¼ íƒ€ê²Ÿ ë‚ ì§œ ê²°ì •
            const targetDate = getTargetDateByCurrentTime();
            const tradingDate = await findLatestTradingDay(targetDate);
            
            // íƒ€ê²Ÿ ë‚ ì§œì— í•´ë‹¹í•˜ëŠ” ID ê³„ì‚°
            currentId = await getTradingDayIdFromDate(tradingDate);
            
            updateUrlInput();
            await updateDateDisplay();
            
            // ê³µíœ´ì¼ ë°ì´í„° ë¯¸ë¦¬ ë¡œë“œ
            await loadHolidaysForYear(2025);
            await loadHolidaysForYear(2026);
            
            // í…Œë§ˆ ë°ì´í„° ë¡œë“œ
            await loadThemeData();
            
            // ìë™ìœ¼ë¡œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            fetchData();
            
            document.addEventListener('click', function(event) {
                const calendar = document.getElementById('calendar');
                const currentDate = document.getElementById('currentDate');
                const settingsCalendar = document.getElementById('settingsCalendar');
                const baseDateDisplay = document.getElementById('baseDateDisplay');
                
                if (calendarVisible && 
                    !calendar.contains(event.target) && 
                    !currentDate.contains(event.target)) {
                    hideCalendar();
                }
                
                if (settingsCalendarVisible && 
                    !settingsCalendar.contains(event.target) && 
                    !baseDateDisplay.contains(event.target)) {
                    hideSettingsCalendar();
                }
            });
        }

        // ğŸ”¥ ì›¹ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
        async function loadWebData() {
            try {
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ì„ì‹œ ë¡œë“œ ì‹œë„ (ì‹¤ì œ ì›¹ í™˜ê²½ì—ì„œëŠ” ì„œë²„ API í˜¸ì¶œ)
                const storedData = localStorage.getItem('webDataBackup');
                if (storedData) {
                    webData = JSON.parse(storedData);
                    
                    // ì›¹ ë°ì´í„°ì—ì„œ ìºì‹œ ë³µì›
                    if (webData.cacheData) {
                        dataCache = new Map(webData.cacheData.dataCache || []);
                        dateToIdCache = new Map(webData.cacheData.dateToIdCache || []);
                        dateIdCache = new Map(webData.cacheData.dateIdCache || []);
                    }
                    
                    // ì›¹ ë°ì´í„°ì—ì„œ í…Œë§ˆ ë°ì´í„° ë³µì›
                    if (webData.themeData) {
                        themeDataCache = webData.themeData.data || {};
                        currentThemeFileName = webData.themeData.fileName || '';
                        updateUploadInfo();
                    }
                    
                    // ì›¹ ë°ì´í„°ì—ì„œ ê¸°ë³¸ ì„¤ì • ë³µì›
                    if (webData.baseSettings) {
                        baseUrl = webData.baseSettings.baseUrl || baseUrl;
                        baseId = parseInt(webData.baseSettings.baseId) || baseId;
                        baseDate = new Date(webData.baseSettings.baseDate || baseDate);
                        currentId = parseInt(webData.currentState?.currentId) || parseInt(baseId);
                        
                        // UI ì—…ë°ì´íŠ¸
                        document.getElementById('baseUrlInput').value = baseUrl;
                        document.getElementById('baseIdInput').value = baseId;
                        document.getElementById('baseDateDisplay').textContent = formatDate(baseDate);
                        updateUrlInput();
                    }
                    
                    console.log('ì›¹ ë°ì´í„° ë¡œë“œ ì„±ê³µ (ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©)');
                } else {
                    console.log('ì›¹ ë°ì´í„° íŒŒì¼(ë˜ëŠ” ë¡œì»¬ìŠ¤í† ë¦¬ì§€)ì´ ì—†ìŠµë‹ˆë‹¤. ê¸°ë³¸ê°’ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.');
                }
            } catch (error) {
                console.error('ì›¹ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
            }
        }

        // ğŸ”¥ ì›¹ ë°ì´í„° ì €ì¥ í•¨ìˆ˜ (ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì„ì‹œ ì €ì¥)
        async function saveWebData() {
            try {
                // í˜„ì¬ ë°ì´í„°ë¡œ ì›¹ ë°ì´í„° ì—…ë°ì´íŠ¸
                webData.metadata.lastUpdated = new Date().toISOString();
                webData.baseSettings = {
                    baseUrl: baseUrl,
                    baseId: baseId,
                    baseDate: baseDate.toISOString()
                };
                webData.themeData = {
                    data: themeDataCache || {},
                    fileName: currentThemeFileName
                };
                webData.cacheData = {
                    dataCache: Array.from(dataCache.entries()),
                    dateToIdCache: Array.from(dateToIdCache.entries()),
                    dateIdCache: Array.from(dateIdCache.entries())
                };
                webData.currentState = {
                    currentId: currentId,
                    currentRealDate: currentRealDate
                };
                
                // ë¡œì»¬ìŠ¤í† ë¦¬ì§€ì— ì„ì‹œ ì €ì¥
                localStorage.setItem('webDataBackup', JSON.stringify(webData));
                
                console.log('ì›¹ ë°ì´í„° ì €ì¥ ì™„ë£Œ (ë¡œì»¬ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©)');
            } catch (error) {
                console.error('ì›¹ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }

        // ğŸ”¥ ëª¨ë“  ë°ì´í„°ë¥¼ JSONìœ¼ë¡œ ë‚´ë³´ë‚´ê¸°
        function exportAllData() {
            try {
                // ëª¨ë“  ë°ì´í„° ìˆ˜ì§‘
                const exportData = {
                    metadata: {
                        version: '1.0',
                        exportDate: new Date().toISOString(),
                        description: 'ì£¼ì‹ Top30 ë°ì´í„° ë°±ì—…'
                    },
                    baseSettings: {
                        baseUrl: baseUrl,
                        baseId: baseId,
                        baseDate: baseDate.toISOString()
                    },
                    themeData: {
                        data: themeDataCache,
                        fileName: currentThemeFileName
                    },
                    cacheData: {
                        dataCache: Array.from(dataCache.entries()),
                        dateToIdCache: Array.from(dateToIdCache.entries()),
                        dateIdCache: Array.from(dateIdCache.entries())
                    },
                    currentState: {
                        currentId: currentId,
                        currentRealDate: currentRealDate
                    }
                };

                // JSON ë¬¸ìì—´ë¡œ ë³€í™˜
                const jsonString = JSON.stringify(exportData, null, 2);
                
                // íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `stock_data_backup_${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showSuccess('ëª¨ë“  ë°ì´í„°ê°€ JSON íŒŒì¼ë¡œ ë‚´ë³´ë‚´ì¡ŒìŠµë‹ˆë‹¤! ğŸ‰');
                console.log('ë‚´ë³´ë‚¸ ë°ì´í„°:', exportData);
            } catch (error) {
                showError('ë°ì´í„° ë‚´ë³´ë‚´ê¸° ì¤‘ ì˜¤ë¥˜ ë°œìƒ: ' + error.message);
            }
        }
        // ... (ë‚˜ë¨¸ì§€ í•¨ìˆ˜ë“¤ì€ ë™ì¼)
    </script>
</body>
</html>